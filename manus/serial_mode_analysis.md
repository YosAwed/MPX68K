# シリアル通信モード時のマウス動作への影響分析

## 問題の確認

修正版のコードを確認したところ、**シリアル通信をオンにした場合、マウスは完全に動作しなくなります**。

## 原因

### コードの構造

```c
if (SCC_RegNumB == 5) {
    if (scc_port_a.mode == SCC_MODE_MOUSE_ONLY) {
        // マウス処理
        ...
    } else {
        // シリアル通信モード時の処理
        if ((data & 2) && scc_port_a.connected) { 
            scc_port_a.tx_ready = 1; 
        }
    }
}
```

この構造により、`scc_port_a.mode`が`SCC_MODE_MOUSE_ONLY`以外の場合（つまりシリアル通信モードの場合）、マウス処理のコードが**全く実行されない**。

## 元のMPX68K版の意図

元のMPX68K版を見ると、この構造は意図的なものであり、**マウスモードとシリアル通信モードは排他的**に設計されている。

つまり、X68000の実機では、SCCポートは以下のいずれかのモードで動作する:
1. マウス専用モード（`SCC_MODE_MOUSE_ONLY`）
2. シリアル通信モード（PTY、TCP、ファイルなど）

## 問題の本質

ユーザーの質問「シリアル通信をオンにするとマウスが動かなくなったりしますか？」に対する答えは:

**はい、現在の設計では、シリアル通信をオンにするとマウスは動作しなくなります。**

これは修正による問題ではなく、**元々のMPX68Kの設計仕様**です。

## 確認すべき点

1. **ユーザーの使用シナリオ**: 
   - シリアル通信とマウスを同時に使用する必要があるのか？
   - それとも、マウスモードで使用している時にダブルクリックが動作すれば良いのか？

2. **X68000の実機の仕様**:
   - X68000の実機では、SCCポートはマウスとシリアル通信のどちらか一方しか使用できない
   - 通常、マウスはSCCポートAに接続され、シリアル通信は別のポートを使用する

3. **MPX68Kの設計意図**:
   - `scc_port_a.mode`という変数で動作モードを切り替える設計
   - この設計は、実機の制約を反映している可能性が高い

## 結論

修正版のコードは、**マウス専用モード（`SCC_MODE_MOUSE_ONLY`）でダブルクリックを正常に動作させる**ことを目的としています。

シリアル通信モードでは、元々マウスは動作しない設計になっています。これは修正による問題ではなく、元のMPX68Kの設計仕様です。

もしユーザーが「シリアル通信とマウスを同時に使用したい」という要望がある場合は、別の修正アプローチが必要になります。
