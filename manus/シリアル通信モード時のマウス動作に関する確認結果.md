# シリアル通信モード時のマウス動作に関する確認結果

## 結論

**修正版のコードでは、シリアル通信をオンにするとマウスは動作しなくなります。**

ただし、これは**修正による問題ではなく、元々のMPX68Kの設計仕様**です。

## MPX68Kの設計

MPX68Kでは、SCCポート（ポートA）は以下のいずれかのモードで排他的に動作します:

1. **マウス専用モード** (`SCC_MODE_MOUSE_ONLY`)
   - デフォルトのモード
   - マウスが正常に動作する
   - シリアル通信は使用できない

2. **シリアル通信モード** (`SCC_MODE_SERIAL_PTY`, `SCC_MODE_SERIAL_TCP`, `SCC_MODE_SERIAL_FILE`, `SCC_MODE_SERIAL_TCP_SERVER`)
   - シリアル通信が使用可能
   - **マウスは動作しない**

## コードの構造

```c
if (SCC_RegNumB == 5) {
    if (scc_port_a.mode == SCC_MODE_MOUSE_ONLY) {
        // マウス処理のコード
        ...
    } else {
        // シリアル通信モード時の処理（マウス処理なし）
        if ((data & 2) && scc_port_a.connected) { 
            scc_port_a.tx_ready = 1; 
        }
    }
}
```

この`if-else`構造により、モードが排他的に制御されています。

## 修正の影響範囲

今回の修正は、**マウス専用モード（`SCC_MODE_MOUSE_ONLY`）でのダブルクリック検出を修正する**ものです。

- **マウス専用モード**: ダブルクリックが正常に動作するようになる（修正の効果）
- **シリアル通信モード**: 元々マウスは動作しない（修正前後で変化なし）

## X68000実機の仕様

X68000の実機では:
- SCCポートAはマウス接続用
- SCCポートBはシリアル通信用（RS-232C）
- 両方を同時に使用可能

しかし、MPX68Kの現在の実装では、ポートAをマウスとシリアル通信で排他的に使用する設計になっています。

## ユーザーへの確認事項

1. **現在の使用シナリオ**:
   - シリアル通信とマウスを同時に使用する必要がありますか？
   - それとも、マウスモードで使用している時にダブルクリックが動作すれば良いですか？

2. **期待される動作**:
   - シリアル通信をオンにした状態でもマウスを使用したい場合は、追加の修正が必要です
   - マウス専用モードでダブルクリックが動作すれば良い場合は、現在の修正で問題ありません

## 追加修正の可能性

もしシリアル通信とマウスを同時に使用したい場合は、以下のような修正が考えられます:

1. **ポートBをシリアル通信専用にする**（実機の仕様に近い）
2. **ポートAでマウスとシリアル通信を多重化する**（複雑な実装が必要）

ただし、これらの修正は大規模な変更になる可能性があります。
