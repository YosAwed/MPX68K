# 実装検証チェックリスト

## 1. ビルドの確認

### 1.1. コンパイル
```bash
# プロジェクトをビルド
# Xcodeの場合: Product > Build (⌘B)
# または: xcodebuild -project MPX68K.xcodeproj -scheme MPX68K
```

- [ ] コンパイルエラーがないこと
- [ ] 警告が新たに発生していないこと

### 1.2. リンク
- [ ] リンクエラーがないこと
- [ ] 実行ファイルが正常に生成されること

## 2. マウス機能のテスト（シリアル通信無効時）

### 2.1. 基本動作
- [ ] エミュレータが起動すること
- [ ] マウスカーソルが表示されること
- [ ] カーソルが滑らかに動くこと

### 2.2. クリック動作
- [ ] 左クリックが認識されること
- [ ] 右クリックが認識されること
- [ ] シングルクリックでファイルが選択されること

### 2.3. ダブルクリック（最重要）
- [ ] Visual Shellでファイルをダブルクリックして開けること
- [ ] ダブルクリックの速度を変えても認識されること
- [ ] 連続してダブルクリックしても正常に動作すること

### 2.4. ドラッグ
- [ ] ファイルをドラッグできること
- [ ] ウィンドウをドラッグ移動できること
- [ ] 範囲選択ができること

## 3. シリアル通信機能のテスト

### 3.1. PTYモード
```swift
// SCCManagerを使用してPTYモードを有効化
let sccManager = SCCManager()
let success = sccManager.createPTY()
```

- [ ] PTYが正常に作成されること
- [ ] スレーブパスが取得できること（例: `/dev/ttys001`）
- [ ] 外部ターミナルから接続できること
  ```bash
  screen /dev/ttys001 9600
  ```
- [ ] データの送受信ができること

### 3.2. TCPクライアントモード
```swift
let success = sccManager.connectTCP(host: "localhost", port: 12345)
```

- [ ] TCPサーバーに接続できること
- [ ] データの送受信ができること
- [ ] 接続が切れた時に適切に処理されること

### 3.3. TCPサーバーモード
```swift
let success = sccManager.setMode(.serialTCPServer, config: "12345")
```

- [ ] 指定ポートでリスニングが開始されること
- [ ] クライアントからの接続を受け付けること
  ```bash
  telnet localhost 12345
  ```
- [ ] データの送受信ができること

### 3.4. ファイルモード
```swift
let success = sccManager.connectSerial(devicePath: "/dev/tty.usbserial")
```

- [ ] シリアルデバイスに接続できること
- [ ] データの送受信ができること

## 4. マウスとシリアル通信の同時動作テスト（最重要）

### 4.1. 基本的な同時動作
1. シリアル通信を有効化（PTYまたはTCP）
2. 外部からシリアル通信を開始
3. 同時にマウスを操作

- [ ] マウスカーソルが正常に動くこと
- [ ] シングルクリックが認識されること
- [ ] **ダブルクリックが認識されること**
- [ ] ドラッグが正常に動作すること
- [ ] シリアル通信のデータが正常に送受信されること

### 4.2. 負荷テスト
1. シリアル通信で大量のデータを送受信
2. 同時にマウスを高速で動かす
3. ダブルクリックを連続で行う

- [ ] マウス操作が遅延しないこと
- [ ] ダブルクリックが失敗しないこと
- [ ] シリアル通信のデータが欠損しないこと

### 4.3. 切り替えテスト
1. マウスのみで動作
2. シリアル通信を有効化
3. マウスとシリアル通信を同時使用
4. シリアル通信を無効化
5. 再びマウスのみで動作

- [ ] 各段階で正常に動作すること
- [ ] 切り替え時にクラッシュしないこと
- [ ] メモリリークがないこと

## 5. Visual Shellでの実地テスト

### 5.1. ファイル操作
- [ ] ファイルをシングルクリックで選択
- [ ] ファイルをダブルクリックで開く
- [ ] フォルダをダブルクリックで開く
- [ ] ファイルをドラッグ＆ドロップで移動

### 5.2. メニュー操作
- [ ] メニューをクリックして開く
- [ ] メニュー項目をクリックして実行
- [ ] メニュー外をクリックして閉じる

### 5.3. ウィンドウ操作
- [ ] ウィンドウのタイトルバーをドラッグして移動
- [ ] ウィンドウのクローズボタンをクリック
- [ ] ウィンドウのサイズ変更（対応している場合）

### 5.4. シリアル通信併用時
上記の操作を、シリアル通信（PTYまたはTCP）を有効化した状態で再テスト

- [ ] 全ての操作が正常に動作すること
- [ ] 特にダブルクリックが確実に認識されること

## 6. パフォーマンステスト

### 6.1. CPU使用率
- [ ] マウスのみ使用時のCPU使用率が適切であること
- [ ] シリアル通信使用時のCPU使用率が適切であること
- [ ] 同時使用時のCPU使用率が過度に上昇しないこと

### 6.2. メモリ使用量
- [ ] メモリリークがないこと
- [ ] 長時間動作させても安定していること

### 6.3. レスポンス
- [ ] マウス操作のレスポンスが良好であること
- [ ] シリアル通信のレイテンシが許容範囲内であること

## 7. エッジケーステスト

### 7.1. 高速操作
- [ ] マウスを非常に速く動かしても追従すること
- [ ] 連続して高速にクリックしても認識されること
- [ ] 高速なダブルクリックも認識されること

### 7.2. 低速操作
- [ ] ゆっくりとしたダブルクリックも認識されること（タイムアウト設定による）
- [ ] マウスを非常にゆっくり動かしても正常に動作すること

### 7.3. 異常系
- [ ] シリアル通信の接続が突然切れても、マウスは動作し続けること
- [ ] シリアル通信の再接続が正常に行えること
- [ ] 不正なデータを受信しても、クラッシュしないこと

## 8. 後方互換性テスト

### 8.1. 既存のコード
- [ ] `SCC_SetMode(SCC_MODE_MOUSE_ONLY, NULL)`が正常に動作すること
- [ ] 既存のSwiftコードが修正なしで動作すること

### 8.2. 既存のセーブデータ
- [ ] 既存のセーブデータが読み込めること
- [ ] 既存の設定が引き継がれること

## 9. デバッグログの確認

### 9.1. 正常系ログ
```
SCC_Init: Initialized
SCC_CreatePTY: Created PTY with slave path: /dev/ttys001
SCC_ReceiveThread: Started, monitoring fd 3
```

- [ ] 適切なログが出力されること
- [ ] エラーログが出力されていないこと

### 9.2. 異常系ログ
- [ ] エラー発生時に適切なエラーメッセージが出力されること
- [ ] スタックトレースが取得できること

## 10. 最終確認

### 10.1. コードレビュー
- [ ] コードが読みやすいこと
- [ ] コメントが適切に記載されていること
- [ ] メモリ管理が適切であること（mutexのロック/アンロック等）

### 10.2. ドキュメント
- [ ] 実装レポートが正確であること
- [ ] チェックリストが完了していること
- [ ] 既知の問題があれば文書化されていること

### 10.3. リリース準備
- [ ] バックアップが取られていること
- [ ] ロールバック手順が明確であること
- [ ] ユーザーへの通知内容が準備されていること

## チェック完了サイン

実装者: ________________  日付: ________

テスター: ________________  日付: ________

承認者: ________________  日付: ________

## 備考

問題が発見された場合は、以下の情報を記録してください:

- 問題の内容:
- 再現手順:
- 期待される動作:
- 実際の動作:
- ログ出力:
- 環境情報（OS、ハードウェア等）:
